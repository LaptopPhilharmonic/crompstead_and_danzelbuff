"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AnimationNode = void 0;
const import_manager_js_1 = require("../import-manager.js");
const ElectronicaGame_js_1 = require("../ElectronicaGame.js");
class AnimationNode extends import_manager_js_1.RenderNode {
    constructor(data) {
        var _a;
        super(data);
        this.imageName = data.imageName;
        this.frameMillis = data.frameMillis;
        this.lastRenderTime = 0;
        this.currentFrame = 0;
        this.loops = (_a = data.loops) !== null && _a !== void 0 ? _a : true;
        const img = ElectronicaGame_js_1.gameData.images.byKey[this.imageName];
        this.frames = Math.floor(img.width / data.w);
        this.totalMillis = this.frameMillis * this.frames;
    }
    /** Updates the currentFrame and lastRenderTime, and returns the new frame number */
    updateFrame(renderTime) {
        this.lastRenderTime = renderTime;
        this.currentFrame += 1;
        if (this.currentFrame >= this.frames) {
            if (this.loops) {
                this.currentFrame = 0;
            }
            else {
                this.currentFrame = this.frames - 1;
            }
        }
        return this.currentFrame;
    }
}
exports.AnimationNode = AnimationNode;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQW5pbWF0aW9uTm9kZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3JlbmRlcmluZy9BbmltYXRpb25Ob2RlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDREQUFrRTtBQUNsRSw4REFBaUQ7QUFhakQsTUFBYSxhQUFjLFNBQVEsOEJBQVU7SUFTekMsWUFBWSxJQUF1Qjs7UUFDL0IsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ1osSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUNwQyxJQUFJLENBQUMsY0FBYyxHQUFHLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQztRQUN0QixJQUFJLENBQUMsS0FBSyxHQUFHLE1BQUEsSUFBSSxDQUFDLEtBQUssbUNBQUksSUFBSSxDQUFDO1FBRWhDLE1BQU0sR0FBRyxHQUFHLDZCQUFRLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDbEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzdDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3RELENBQUM7SUFFRCxvRkFBb0Y7SUFDcEYsV0FBVyxDQUFDLFVBQWtCO1FBQzFCLElBQUksQ0FBQyxjQUFjLEdBQUcsVUFBVSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxZQUFZLElBQUksQ0FBQyxDQUFDO1FBQ3ZCLElBQUksSUFBSSxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2xDLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtnQkFDWixJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQzthQUN6QjtpQkFBTTtnQkFDSCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO2FBQ3ZDO1NBQ0o7UUFDRCxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUM7SUFDN0IsQ0FBQztDQUNKO0FBbkNELHNDQW1DQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlbmRlck5vZGUsIFJlbmRlck5vZGVEYXRhIH0gZnJvbSAnLi4vaW1wb3J0LW1hbmFnZXIuanMnO1xyXG5pbXBvcnQgeyBnYW1lRGF0YSB9IGZyb20gJy4uL0VsZWN0cm9uaWNhR2FtZS5qcyc7XHJcblxyXG5leHBvcnQgdHlwZSBBbmltYXRpb25Ob2RlRGF0YSA9IFJlbmRlck5vZGVEYXRhICYge1xyXG4gICAgaW1hZ2VOYW1lOiBzdHJpbmc7XHJcbiAgICAvKiogUHJvdmlkZSB0aGUgd2lkdGggb2YgYSBzaW5nbGUgZnJhbWUsIG5vdCB0aGUgd2hvbGUgaW1hZ2UuIE5vdCBvcHRpb25hbCBiZWNhdXNlIHdlIHVzZWQgaXQgdG8gY2FsY3VsYXRlIHRoaW5ncy4gKi9cclxuICAgIHc6IG51bWJlcjtcclxuICAgIC8qKiBSZXF1aXJlZCAqL1xyXG4gICAgaDogbnVtYmVyO1xyXG4gICAgZnJhbWVNaWxsaXM6IG51bWJlcjtcclxuICAgIC8qKiBEZWZhdWx0cyB0byB0cnVlICovXHJcbiAgICBsb29wcz86IGJvb2xlYW47XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBBbmltYXRpb25Ob2RlIGV4dGVuZHMgUmVuZGVyTm9kZSB7XHJcbiAgICBpbWFnZU5hbWU6IHN0cmluZztcclxuICAgIGZyYW1lTWlsbGlzOiBudW1iZXI7XHJcbiAgICBmcmFtZXM6IG51bWJlcjtcclxuICAgIHRvdGFsTWlsbGlzOiBudW1iZXI7XHJcbiAgICBsYXN0UmVuZGVyVGltZTogbnVtYmVyO1xyXG4gICAgY3VycmVudEZyYW1lOiBudW1iZXI7XHJcbiAgICBsb29wczogYm9vbGVhbjtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihkYXRhOiBBbmltYXRpb25Ob2RlRGF0YSkge1xyXG4gICAgICAgIHN1cGVyKGRhdGEpO1xyXG4gICAgICAgIHRoaXMuaW1hZ2VOYW1lID0gZGF0YS5pbWFnZU5hbWU7XHJcbiAgICAgICAgdGhpcy5mcmFtZU1pbGxpcyA9IGRhdGEuZnJhbWVNaWxsaXM7XHJcbiAgICAgICAgdGhpcy5sYXN0UmVuZGVyVGltZSA9IDA7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50RnJhbWUgPSAwO1xyXG4gICAgICAgIHRoaXMubG9vcHMgPSBkYXRhLmxvb3BzID8/IHRydWU7XHJcblxyXG4gICAgICAgIGNvbnN0IGltZyA9IGdhbWVEYXRhLmltYWdlcy5ieUtleVt0aGlzLmltYWdlTmFtZV07XHJcbiAgICAgICAgdGhpcy5mcmFtZXMgPSBNYXRoLmZsb29yKGltZy53aWR0aCAvIGRhdGEudyk7XHJcbiAgICAgICAgdGhpcy50b3RhbE1pbGxpcyA9IHRoaXMuZnJhbWVNaWxsaXMgKiB0aGlzLmZyYW1lcztcclxuICAgIH1cclxuXHJcbiAgICAvKiogVXBkYXRlcyB0aGUgY3VycmVudEZyYW1lIGFuZCBsYXN0UmVuZGVyVGltZSwgYW5kIHJldHVybnMgdGhlIG5ldyBmcmFtZSBudW1iZXIgKi9cclxuICAgIHVwZGF0ZUZyYW1lKHJlbmRlclRpbWU6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICAgICAgdGhpcy5sYXN0UmVuZGVyVGltZSA9IHJlbmRlclRpbWU7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50RnJhbWUgKz0gMTtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50RnJhbWUgPj0gdGhpcy5mcmFtZXMpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMubG9vcHMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEZyYW1lID0gMDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEZyYW1lID0gdGhpcy5mcmFtZXMgLSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRGcmFtZTtcclxuICAgIH1cclxufSJdfQ==