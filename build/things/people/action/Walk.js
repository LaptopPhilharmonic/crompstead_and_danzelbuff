"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Walk = void 0;
const import_manager_js_1 = require("../../../import-manager.js");
class Walk extends import_manager_js_1.Action {
    constructor(person, direction, duration = 200) {
        super();
        this.person = person;
        this.direction = direction;
        this.duration = duration;
        // Will be initt'd when the start() method is called
        this.fromSquare = { x: 0, y: 0 };
        this.toSquare = { x: 0, y: 0 };
        this.fromPx = { x: 0, y: 0 };
        this.toPx = { x: 0, y: 0 };
        this.xChange = 0;
        this.yChange = 0;
    }
    start() {
        var _a, _b, _c;
        super.start();
        this.fromSquare = {
            x: this.person.gridX,
            y: this.person.gridY,
        };
        let toX = undefined;
        let toY = undefined;
        switch (this.direction) {
            case 'up':
                toY = this.fromSquare.y - 1;
                break;
            case 'down':
                toY = this.fromSquare.y + 1;
                break;
            case 'left':
                toX = this.fromSquare.x - 1;
                break;
            case 'right':
                toX = this.fromSquare.x + 1;
        }
        this.toSquare = {
            x: toX ? toX : this.person.gridX,
            y: toY ? toY : this.person.gridY,
        };
        // Location should really exist but you never know
        const gridSize = (_c = (_b = (_a = this.person) === null || _a === void 0 ? void 0 : _a.location) === null || _b === void 0 ? void 0 : _b.gridSize) !== null && _c !== void 0 ? _c : 1;
        // We need to lop a pixel off the distance in the direction travelled to stop jerky walking if the key stays held in
        let xReduction = 0;
        if (this.direction === 'left') {
            xReduction = -1;
        }
        else if (this.direction === 'right') {
            xReduction = 1;
        }
        let yReduction = 0;
        if (this.direction === 'up') {
            yReduction = -1;
        }
        else if (this.direction === 'down') {
            yReduction = 1;
        }
        // Used to smooth walking motion when holding down key for multiple squares
        const frameFactor = gridSize / (this.duration / import_manager_js_1.gameData.frameLengthMillis);
        this.xChange = (gridSize * xReduction) - xReduction * frameFactor;
        this.yChange = (gridSize * yReduction) - yReduction * frameFactor;
        this.fromPx = {
            x: (this.fromSquare.x * gridSize) + xReduction * frameFactor,
            y: (this.fromSquare.y * gridSize) + yReduction * frameFactor,
        };
        this.toPx = {
            x: this.toSquare.x * gridSize,
            y: this.toSquare.y * gridSize,
        };
        const renderNode = this.person.renderNodes.walking[this.direction];
        renderNode.setX(this.fromPx.x);
        renderNode.setY(this.fromPx.y);
        this.person.currentRenderNode = renderNode;
        this.person.gridX = this.toSquare.x;
        this.person.gridY = this.toSquare.y;
    }
    update(frameTimeStamp) {
        const amountComplete = (frameTimeStamp - this.startTime) / this.duration;
        if (amountComplete < 1) {
            this.person.currentRenderNode.setX(this.fromPx.x + Math.round(this.xChange * amountComplete));
            this.person.currentRenderNode.setY(this.fromPx.y + Math.round(this.yChange * amountComplete));
        }
        else {
            this.person.snapCurrentRenderNodeToGrid();
            this.finish();
        }
    }
}
exports.Walk = Walk;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2Fsay5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3RoaW5ncy9wZW9wbGUvYWN0aW9uL1dhbGsudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsa0VBQXNFO0FBYXRFLE1BQWEsSUFBSyxTQUFRLDBCQUFNO0lBVzVCLFlBQVksTUFBYyxFQUFFLFNBQXdCLEVBQUUsV0FBbUIsR0FBRztRQUN4RSxLQUFLLEVBQUUsQ0FBQztRQUNSLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1FBQzNCLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBRXpCLG9EQUFvRDtRQUNwRCxJQUFJLENBQUMsVUFBVSxHQUFHLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUM7UUFDL0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxDQUFDO1FBQzdCLElBQUksQ0FBQyxNQUFNLEdBQUcsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsSUFBSSxHQUFHLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUM7UUFDekIsSUFBSSxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUM7UUFDakIsSUFBSSxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUM7SUFDckIsQ0FBQztJQUVELEtBQUs7O1FBQ0QsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2QsSUFBSSxDQUFDLFVBQVUsR0FBRztZQUNkLENBQUMsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUs7WUFDcEIsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSztTQUN2QixDQUFBO1FBQ0Qs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QyxDQUFDLENBQUMsQ0FBQztRQUMvQixVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDL0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsR0FBRyxVQUFVLENBQUM7UUFDM0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUVELE1BQU0sQ0FBQyxjQUFzQjtRQUN6QixNQUFNLGNBQWMsR0FBRyxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUN6RSxJQUFJLGNBQWMsR0FBRyxDQUFDLEVBQUU7WUFDcEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxHQUFHLGNBQWMsQ0FBQyxDQUFDLENBQUM7WUFDOUYsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxHQUFHLGNBQWMsQ0FBQyxDQUFDLENBQUM7U0FDakc7YUFBTTtZQUNILElBQUksQ0FBQyxNQUFNLENBQUMsMkJBQTJCLEVBQUUsQ0FBQztZQUMxQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7U0FDakI7SUFDTCxDQUFDO0NBQ0o7QUF0R0Qsb0JBc0dDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWN0aW9uLCBQZXJzb24sIGdhbWVEYXRhIH0gZnJvbSAnLi4vLi4vLi4vaW1wb3J0LW1hbmFnZXIuanMnO1xyXG5cclxuZXhwb3J0IHR5cGUgV2Fsa0RpcmVjdGlvbiA9ICd1cCcgfCAnZG93bicgfCAnbGVmdCcgfCAncmlnaHQnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBXYWxrRGF0YSB7XHJcbiAgICAvKiogVGhlIHBlcnNvbiBkb2luZyB0aGUgd2Fsa2luZyAqL1xyXG4gICAgcGVyc29uOiBQZXJzb247XHJcbiAgICAvKiogVGhlIGRpcmVjdGlvbiB0aGUgcGVyc29uIGlzIHdhbGtpbmcgaW4gKi9cclxuICAgIGRpcmVjdGlvbjogV2Fsa0RpcmVjdGlvbjtcclxuICAgIC8qKiBIb3cgbG9uZyB0aGlzIG9uZSBzcXVhcmUgd2FsayBzaG91bGQgbGFzdCBpbiBtaWxsaXNlY29uZHMuIERlZmF1bHQgMzAwICovXHJcbiAgICBkdXJhdGlvbjogbnVtYmVyO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgV2FsayBleHRlbmRzIEFjdGlvbiB7XHJcbiAgICBwcml2YXRlIHBlcnNvbjogUGVyc29uO1xyXG4gICAgcHJpdmF0ZSBkaXJlY3Rpb246IFdhbGtEaXJlY3Rpb247XHJcbiAgICBwcml2YXRlIGR1cmF0aW9uOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIGZyb21TcXVhcmU6IHt4OiBudW1iZXIsIHk6IG51bWJlcn1cclxuICAgIHByaXZhdGUgdG9TcXVhcmU6IHt4OiBudW1iZXIsIHk6IG51bWJlcn1cclxuICAgIHByaXZhdGUgZnJvbVB4OiB7eDogbnVtYmVyLCB5OiBudW1iZXJ9XHJcbiAgICBwcml2YXRlIHRvUHg6IHt4OiBudW1iZXIsIHk6IG51bWJlcn1cclxuICAgIHByaXZhdGUgeENoYW5nZTogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSB5Q2hhbmdlOiBudW1iZXI7XHJcblxyXG4gICAgY29uc3RydWN0b3IocGVyc29uOiBQZXJzb24sIGRpcmVjdGlvbjogV2Fsa0RpcmVjdGlvbiwgZHVyYXRpb246IG51bWJlciA9IDIwMCkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgdGhpcy5wZXJzb24gPSBwZXJzb247XHJcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBkaXJlY3Rpb247XHJcbiAgICAgICAgdGhpcy5kdXJhdGlvbiA9IGR1cmF0aW9uO1xyXG5cclxuICAgICAgICAvLyBXaWxsIGJlIGluaXR0J2Qgd2hlbiB0aGUgc3RhcnQoKSBtZXRob2QgaXMgY2FsbGVkXHJcbiAgICAgICAgdGhpcy5mcm9tU3F1YXJlID0ge3g6IDAsIHk6IDB9O1xyXG4gICAgICAgIHRoaXMudG9TcXVhcmUgPSB7eDogMCwgeTogMH07XHJcbiAgICAgICAgdGhpcy5mcm9tUHggPSB7eDogMCwgeTogMH07XHJcbiAgICAgICAgdGhpcy50b1B4ID0ge3g6IDAsIHk6IDB9O1xyXG4gICAgICAgIHRoaXMueENoYW5nZSA9IDA7XHJcbiAgICAgICAgdGhpcy55Q2hhbmdlID0gMDtcclxuICAgIH1cclxuXHJcbiAgICBzdGFydCgpIHtcclxuICAgICAgICBzdXBlci5zdGFydCgpO1xyXG4gICAgICAgIHRoaXMuZnJvbVNxdWFyZSA9IHtcclxuICAgICAgICAgICAgeDogdGhpcy5wZXJzb24uZ3JpZFgsXHJcbiAgICAgICAgICAgIHk6IHRoaXMucGVyc29uLmdyaWRZLFxyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgdG9YOiBudW1iZXIgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgbGV0IHRvWTogbnVtYmVyIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5kaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgY2FzZSAndXAnOlxyXG4gICAgICAgICAgICAgICAgdG9ZID0gdGhpcy5mcm9tU3F1YXJlLnkgLSAxO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2Rvd24nOlxyXG4gICAgICAgICAgICAgICAgdG9ZID0gdGhpcy5mcm9tU3F1YXJlLnkgKyAxO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgICAgICAgICAgdG9YID0gdGhpcy5mcm9tU3F1YXJlLnggLSAxO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICAgICAgICAgIHRvWCA9IHRoaXMuZnJvbVNxdWFyZS54ICsgMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy50b1NxdWFyZSA9IHtcclxuICAgICAgICAgICAgeDogdG9YID8gdG9YIDogdGhpcy5wZXJzb24uZ3JpZFgsXHJcbiAgICAgICAgICAgIHk6IHRvWSA/IHRvWSA6IHRoaXMucGVyc29uLmdyaWRZLFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gTG9jYXRpb24gc2hvdWxkIHJlYWxseSBleGlzdCBidXQgeW91IG5ldmVyIGtub3dcclxuICAgICAgICBjb25zdCBncmlkU2l6ZSA9IHRoaXMucGVyc29uPy5sb2NhdGlvbj8uZ3JpZFNpemUgPz8gMTtcclxuXHJcbiAgICAgICAgLy8gV2UgbmVlZCB0byBsb3AgYSBwaXhlbCBvZmYgdGhlIGRpc3RhbmNlIGluIHRoZSBkaXJlY3Rpb24gdHJhdmVsbGVkIHRvIHN0b3AgamVya3kgd2Fsa2luZyBpZiB0aGUga2V5IHN0YXlzIGhlbGQgaW5cclxuICAgICAgICBsZXQgeFJlZHVjdGlvbiA9IDA7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09PSAnbGVmdCcpIHtcclxuICAgICAgICAgICAgeFJlZHVjdGlvbiA9IC0xO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5kaXJlY3Rpb24gPT09ICdyaWdodCcpIHtcclxuICAgICAgICAgICAgeFJlZHVjdGlvbiA9IDE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgeVJlZHVjdGlvbiA9IDA7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09PSAndXAnKSB7XHJcbiAgICAgICAgICAgIHlSZWR1Y3Rpb24gPSAtMVxyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5kaXJlY3Rpb24gPT09ICdkb3duJykge1xyXG4gICAgICAgICAgICB5UmVkdWN0aW9uID0gMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFVzZWQgdG8gc21vb3RoIHdhbGtpbmcgbW90aW9uIHdoZW4gaG9sZGluZyBkb3duIGtleSBmb3IgbXVsdGlwbGUgc3F1YXJlc1xyXG4gICAgICAgIGNvbnN0IGZyYW1lRmFjdG9yID0gZ3JpZFNpemUgLyAodGhpcy5kdXJhdGlvbiAvIGdhbWVEYXRhLmZyYW1lTGVuZ3RoTWlsbGlzKTtcclxuXHJcbiAgICAgICAgdGhpcy54Q2hhbmdlID0gKGdyaWRTaXplICogeFJlZHVjdGlvbikgLSB4UmVkdWN0aW9uICogZnJhbWVGYWN0b3I7XHJcbiAgICAgICAgdGhpcy55Q2hhbmdlID0gKGdyaWRTaXplICogeVJlZHVjdGlvbikgLSB5UmVkdWN0aW9uICogZnJhbWVGYWN0b3I7XHJcbiAgICAgICAgdGhpcy5mcm9tUHggPSB7XHJcbiAgICAgICAgICAgIHg6ICh0aGlzLmZyb21TcXVhcmUueCAqIGdyaWRTaXplKSArIHhSZWR1Y3Rpb24gKiBmcmFtZUZhY3RvcixcclxuICAgICAgICAgICAgeTogKHRoaXMuZnJvbVNxdWFyZS55ICogZ3JpZFNpemUpICsgeVJlZHVjdGlvbiAqIGZyYW1lRmFjdG9yLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy50b1B4ID0ge1xyXG4gICAgICAgICAgICB4OiB0aGlzLnRvU3F1YXJlLnggKiBncmlkU2l6ZSxcclxuICAgICAgICAgICAgeTogdGhpcy50b1NxdWFyZS55ICogZ3JpZFNpemUsXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgcmVuZGVyTm9kZSA9IHRoaXMucGVyc29uLnJlbmRlck5vZGVzLndhbGtpbmdbdGhpcy5kaXJlY3Rpb25dO1xyXG4gICAgICAgIHJlbmRlck5vZGUuc2V0WCh0aGlzLmZyb21QeC54KTtcclxuICAgICAgICByZW5kZXJOb2RlLnNldFkodGhpcy5mcm9tUHgueSk7XHJcbiAgICAgICAgdGhpcy5wZXJzb24uY3VycmVudFJlbmRlck5vZGUgPSByZW5kZXJOb2RlO1xyXG4gICAgICAgIHRoaXMucGVyc29uLmdyaWRYID0gdGhpcy50b1NxdWFyZS54O1xyXG4gICAgICAgIHRoaXMucGVyc29uLmdyaWRZID0gdGhpcy50b1NxdWFyZS55O1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZShmcmFtZVRpbWVTdGFtcDogbnVtYmVyKSB7XHJcbiAgICAgICAgY29uc3QgYW1vdW50Q29tcGxldGUgPSAoZnJhbWVUaW1lU3RhbXAgLSB0aGlzLnN0YXJ0VGltZSkgLyB0aGlzLmR1cmF0aW9uO1xyXG4gICAgICAgIGlmIChhbW91bnRDb21wbGV0ZSA8IDEpIHtcclxuICAgICAgICAgICAgdGhpcy5wZXJzb24uY3VycmVudFJlbmRlck5vZGUuc2V0WCh0aGlzLmZyb21QeC54ICsgTWF0aC5yb3VuZCh0aGlzLnhDaGFuZ2UgKiBhbW91bnRDb21wbGV0ZSkpO1xyXG4gICAgICAgICAgICB0aGlzLnBlcnNvbi5jdXJyZW50UmVuZGVyTm9kZS5zZXRZKHRoaXMuZnJvbVB4LnkgKyBNYXRoLnJvdW5kKHRoaXMueUNoYW5nZSAqIGFtb3VudENvbXBsZXRlKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5wZXJzb24uc25hcEN1cnJlbnRSZW5kZXJOb2RlVG9HcmlkKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZmluaXNoKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59Il19