"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.InputManager = exports.KeyData = void 0;
const defaultConfig = {
    up: 'ArrowUp',
    down: 'ArrowDown',
    left: 'ArrowLeft',
    right: 'ArrowRight',
    interact: ' ',
};
/** A snapshot of data for a key for one cycle of the engine */
class KeyData {
    constructor(held, justPressed, justReleased) {
        this.justPressed = justPressed;
        this.held = held;
        this.justReleased = justReleased;
    }
}
exports.KeyData = KeyData;
function blankKeys() {
    return {
        up: false,
        down: false,
        left: false,
        right: false,
        interact: false,
    };
}
function cloneKeys(keys) {
    return {
        up: keys.up,
        down: keys.down,
        left: keys.left,
        right: keys.right,
        interact: keys.interact,
    };
}
class InputManager {
    constructor(config) {
        this.config = config !== null && config !== void 0 ? config : defaultConfig;
        this.previousKeys = blankKeys();
        this.keys = blankKeys();
    }
    listenTo(listenTarget) {
        listenTarget.addEventListener('keydown', (event) => {
            this.handleKey(event.key, true);
        });
        listenTarget.addEventListener('keyup', (event) => {
            this.handleKey(event.key, false);
        });
    }
    handleKey(keyName, pressedDown) {
        switch (keyName) {
            case this.config.up:
                this.keys.up = pressedDown;
                break;
            case this.config.down:
                this.keys.down = pressedDown;
                break;
            case this.config.left:
                this.keys.left = pressedDown;
                break;
            case this.config.right:
                this.keys.right = pressedDown;
                break;
            case this.config.interact:
                this.keys.interact = pressedDown;
                break;
        }
    }
    cycleKeyData() {
        const keyData = {
            up: this.getKeyData(this.keys.up, this.previousKeys.up),
            down: this.getKeyData(this.keys.down, this.previousKeys.down),
            left: this.getKeyData(this.keys.left, this.previousKeys.left),
            right: this.getKeyData(this.keys.right, this.previousKeys.right),
            interact: this.getKeyData(this.keys.interact, this.previousKeys.interact),
        };
        this.previousKeys = Object.assign({}, this.keys);
        return keyData;
    }
    getKeyData(key, previousKey) {
        return new KeyData(key, key && !previousKey, !key && previousKey);
    }
}
exports.InputManager = InputManager;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW5wdXRNYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vaW5wdXQvSW5wdXRNYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQWVBLE1BQU0sYUFBYSxHQUFnQjtJQUMvQixFQUFFLEVBQUUsU0FBUztJQUNiLElBQUksRUFBRSxXQUFXO0lBQ2pCLElBQUksRUFBRSxXQUFXO0lBQ2pCLEtBQUssRUFBRSxZQUFZO0lBQ25CLFFBQVEsRUFBRSxHQUFHO0NBQ2hCLENBQUE7QUFFRCwrREFBK0Q7QUFDL0QsTUFBYSxPQUFPO0lBUWhCLFlBQVksSUFBYSxFQUFFLFdBQW9CLEVBQUUsWUFBcUI7UUFDbEUsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7UUFDL0IsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7SUFDckMsQ0FBQztDQUNKO0FBYkQsMEJBYUM7QUFrQkQsU0FBUyxTQUFTO0lBQ2QsT0FBTztRQUNILEVBQUUsRUFBRSxLQUFLO1FBQ1QsSUFBSSxFQUFFLEtBQUs7UUFDWCxJQUFJLEVBQUUsS0FBSztRQUNYLEtBQUssRUFBRSxLQUFLO1FBQ1osUUFBUSxFQUFFLEtBQUs7S0FDbEIsQ0FBQTtBQUNMLENBQUM7QUFFRCxTQUFTLFNBQVMsQ0FBQyxJQUFVO0lBQ3pCLE9BQU87UUFDSCxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUU7UUFDWCxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7UUFDZixJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7UUFDZixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUs7UUFDakIsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO0tBQzFCLENBQUE7QUFDTCxDQUFDO0FBRUQsTUFBYSxZQUFZO0lBS3JCLFlBQVksTUFBb0I7UUFDNUIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLGFBQU4sTUFBTSxjQUFOLE1BQU0sR0FB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ZnJvbSBFdmVudC5rZXkgKi9cclxuZXhwb3J0IGludGVyZmFjZSBJbnB1dENvbmZpZyB7XHJcbiAgICAvKiogRGVmYXVsdCAnQXJyb3dVcCcgKi9cclxuICAgIHVwOiBzdHJpbmc7XHJcbiAgICAvKiogRGVmYXVsdCAnQXJyb3dEb3duJyAqL1xyXG4gICAgZG93bjogc3RyaW5nO1xyXG4gICAgLyoqIERlZmF1bHQgJ0Fycm93TGVmdCcgKi9cclxuICAgIGxlZnQ6IHN0cmluZztcclxuICAgIC8qKiBEZWZhdWx0ICdBcnJvd1JpZ2h0JyAqLyAgICBcclxuICAgIHJpZ2h0OiBzdHJpbmc7XHJcbiAgICAvKiogRGVmYXVsdCAnICcgLSBpLmUuIFNwYWNlICovICAgIFxyXG4gICAgaW50ZXJhY3Q6IHN0cmluZztcclxufVxyXG5cclxuY29uc3QgZGVmYXVsdENvbmZpZzogSW5wdXRDb25maWcgPSB7XHJcbiAgICB1cDogJ0Fycm93VXAnLFxyXG4gICAgZG93bjogJ0Fycm93RG93bicsXHJcbiAgICBsZWZ0OiAnQXJyb3dMZWZ0JyxcclxuICAgIHJpZ2h0OiAnQXJyb3dSaWdodCcsXHJcbiAgICBpbnRlcmFjdDogJyAnLFxyXG59XHJcblxyXG4vKiogQSBzbmFwc2hvdCBvZiBkYXRhIGZvciBhIGtleSBmb3Igb25lIGN5Y2xlIG9mIHRoZSBlbmdpbmUgKi9cclxuZXhwb3J0IGNsYXNzIEtleURhdGEge1xyXG4gICAgLyoqIERpZCBhIGtleWRvd24gcmVnaXN0ZXIgdGhpcyBjeWNsZSBmb3IgdGhpcyBrZXk/ICovXHJcbiAgICBqdXN0UHJlc3NlZDogYm9vbGVhbjtcclxuICAgIC8qKiBJcyB0aGlzIGtleSBjdXJyZW50bHkgaGVsZD8gKHRoaXMgd2lsbCByZXR1cm4gdHJ1ZSBhdCB0aGUgc2FtZSB0aW1lIGFzIGp1c3RQcmVzc2VkKSAqL1xyXG4gICAgaGVsZDogYm9vbGVhbjtcclxuICAgIC8qKiBEaWQgYSBrZXl1cCByZWdpc3RlciB0aGlzIGN5Y2xlIGZvciB0aGlzIGtleT8gKi9cclxuICAgIGp1c3RSZWxlYXNlZDogYm9vbGVhbjtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihoZWxkOiBib29sZWFuLCBqdXN0UHJlc3NlZDogYm9vbGVhbiwganVzdFJlbGVhc2VkOiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy5qdXN0UHJlc3NlZCA9IGp1c3RQcmVzc2VkO1xyXG4gICAgICAgIHRoaXMuaGVsZCA9IGhlbGQ7XHJcbiAgICAgICAgdGhpcy5qdXN0UmVsZWFzZWQgPSBqdXN0UmVsZWFzZWQ7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSW5wdXREYXRhIHtcclxuICAgIHVwOiBLZXlEYXRhO1xyXG4gICAgZG93bjogS2V5RGF0YTtcclxuICAgIGxlZnQ6IEtleURhdGE7XHJcbiAgICByaWdodDogS2V5RGF0YTtcclxuICAgIGludGVyYWN0OiBLZXlEYXRhO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEtleXMge1xyXG4gICAgdXA6IGJvb2xlYW47XHJcbiAgICBkb3duOiBib29sZWFuO1xyXG4gICAgbGVmdDogYm9vbGVhbjtcclxuICAgIHJpZ2h0OiBib29sZWFuO1xyXG4gICAgaW50ZXJhY3Q6IGJvb2xlYW47XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGJsYW5rS2V5cygpOiBLZXlzIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgdXA6IGZhbHNlLFxyXG4gICAgICAgIGRvd246IGZhbHNlLFxyXG4gICAgICAgIGxlZnQ6IGZhbHNlLFxyXG4gICAgICAgIHJpZ2h0OiBmYWxzZSxcclxuICAgICAgICBpbnRlcmFjdDogZmFsc2UsXHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsb25lS2V5cyhrZXlzOiBLZXlzKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHVwOiBrZXlzLnVwLFxyXG4gICAgICAgIGRvd246IGtleXMuZG93bixcclxuICAgICAgICBsZWZ0OiBrZXlzLmxlZnQsXHJcbiAgICAgICAgcmlnaHQ6IGtleXMucmlnaHQsXHJcbiAgICAgICAgaW50ZXJhY3Q6IGtleXMuaW50ZXJhY3QsXHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBJbnB1dE1hbmFnZXIge1xyXG4gICAgcHJpdmF0ZSBwcmV2aW91c0tleXM6IEtleXM7XHJcbiAgICBwcml2YXRlIGNvbmZpZzogSW5wdXRDb25maWc7XHJcbiAgICBrZXlzOiBLZXlzO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGNvbmZpZz86IElucHV0Q29uZmlnKSB7XHJcbiAgICAgICAgdGhpcy5jb25maWcgPSBjb25maWcgPz8gZGVmYXVsdENvbmZpZztcclxuICAgICAgICB0aGlzLnByZXZpb3VzS2V5cyA9IGJsYW5rS2V5cygpO1xyXG4gICAgICAgIHRoaXMua2V5cyA9IGJsYW5rS2V5cygpO1xyXG4gICAgfVxyXG5cclxuICAgIGxpc3RlblRvKGxpc3RlblRhcmdldDogV2luZG93IHwgSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICBsaXN0ZW5UYXJnZXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmhhbmRsZUtleSgoZXZlbnQgYXMgS2V5Ym9hcmRFdmVudCkua2V5LCB0cnVlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBsaXN0ZW5UYXJnZXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5oYW5kbGVLZXkoKGV2ZW50IGFzIEtleWJvYXJkRXZlbnQpLmtleSwgZmFsc2UpO1xyXG4gICAgICAgIH0pOyAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBoYW5kbGVLZXkoa2V5TmFtZTogc3RyaW5nLCBwcmVzc2VkRG93bjogYm9vbGVhbikge1xyXG4gICAgICAgIHN3aXRjaChrZXlOYW1lKSB7XHJcbiAgICAgICAgICAgIGNhc2UgdGhpcy5jb25maWcudXA6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmtleXMudXAgPSBwcmVzc2VkRG93bjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIHRoaXMuY29uZmlnLmRvd246XHJcbiAgICAgICAgICAgICAgICB0aGlzLmtleXMuZG93biA9IHByZXNzZWREb3duO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgdGhpcy5jb25maWcubGVmdDpcclxuICAgICAgICAgICAgICAgIHRoaXMua2V5cy5sZWZ0ID0gcHJlc3NlZERvd247XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSB0aGlzLmNvbmZpZy5yaWdodDpcclxuICAgICAgICAgICAgICAgIHRoaXMua2V5cy5yaWdodCA9IHByZXNzZWREb3duOyAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgdGhpcy5jb25maWcuaW50ZXJhY3Q6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmtleXMuaW50ZXJhY3QgPSBwcmVzc2VkRG93bjtcclxuICAgICAgICAgICAgICAgIGJyZWFrOyAgICBcclxuICAgICAgICB9ICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBjeWNsZUtleURhdGEoKTogSW5wdXREYXRhIHtcclxuICAgICAgICBjb25zdCBrZXlEYXRhID0ge1xyXG4gICAgICAgICAgICB1cDogdGhpcy5nZXRLZXlEYXRhKHRoaXMua2V5cy51cCwgdGhpcy5wcmV2aW91c0tleXMudXApLFxyXG4gICAgICAgICAgICBkb3duOiB0aGlzLmdldEtleURhdGEodGhpcy5rZXlzLmRvd24sIHRoaXMucHJldmlvdXNLZXlzLmRvd24pLFxyXG4gICAgICAgICAgICBsZWZ0OiB0aGlzLmdldEtleURhdGEodGhpcy5rZXlzLmxlZnQsIHRoaXMucHJldmlvdXNLZXlzLmxlZnQpLFxyXG4gICAgICAgICAgICByaWdodDogdGhpcy5nZXRLZXlEYXRhKHRoaXMua2V5cy5yaWdodCwgdGhpcy5wcmV2aW91c0tleXMucmlnaHQpLFxyXG4gICAgICAgICAgICBpbnRlcmFjdDogdGhpcy5nZXRLZXlEYXRhKHRoaXMua2V5cy5pbnRlcmFjdCwgdGhpcy5wcmV2aW91c0tleXMuaW50ZXJhY3QpLCAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5wcmV2aW91c0tleXMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmtleXMpO1xyXG4gICAgICAgIHJldHVybiBrZXlEYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0S2V5RGF0YShrZXk6IGJvb2xlYW4sIHByZXZpb3VzS2V5OiBib29sZWFuKTogS2V5RGF0YSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBLZXlEYXRhKGtleSwga2V5ICYmICFwcmV2aW91c0tleSwgIWtleSAmJiBwcmV2aW91c0tleSk7XHJcbiAgICB9XHJcbn0iXX0=